<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title th:text="${editMode} ? 'ÏùºÍ∏∞Ïû• ÏàòÏ†ï' : 'ÏÉà ÏùºÍ∏∞Ïû• ÏÉùÏÑ±'">
      ÏùºÍ∏∞Ïû•
    </title>
    <link rel="stylesheet" th:href="@{/css/common.css}" />
    <style>
      body {
        padding: 20px;
        font-family: sans-serif;
      }

      input {
        padding: 10px;
        font-size: 16px;
        width: 300px;
      }

      button {
        margin-top: 10px;
        padding: 10px 20px;
        font-size: 14px;
        cursor: pointer;
        background-color: #e4e4e4;
        border-radius: 8px;
        border: none;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h2
      th:text="${editMode} ? '‚úèÔ∏è ÏùºÍ∏∞Ïû• Ïù¥Î¶Ñ ÏàòÏ†ï' : 'üìö ÏÉà ÏùºÍ∏∞Ïû• ÏÉùÏÑ±'"
    ></h2>

    <!-- ÏûÖÎ†•Ï∞Ω -->
    <input
      type="text"
      id="diaryName"
      name="name"
      th:value="${diary.name}"
      placeholder="ÏùºÍ∏∞Ïû• Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
      required
    />

    <!-- Î≤ÑÌäº (JSÏóêÏÑú Ï≤òÎ¶¨) -->
    <div>
      <button
        type="button"
        id="submitBtn"
        th:text="${editMode} ? 'ÏàòÏ†ï' : 'ÏÉùÏÑ±'"
      ></button>
    </div>

    <br />
    <a th:href="@{/diary}"><button>‚Üê Î™©Î°ùÏúºÎ°ú</button></a>

    <!-- JSÎ°ú POST or PUT ÏöîÏ≤≠ Ï≤òÎ¶¨ -->
    <script th:inline="javascript">
      const editMode = [[${editMode}]];
      const diaryId = [[${diaryId}]];
      const submitBtn = document.getElementById("submitBtn");

      submitBtn.addEventListener("click", () => {
        const name = document.getElementById("diaryName").value.trim();
        if (!name) {
          alert("Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");
          return;
        }

        const url = editMode ? `/api/diary/${diaryId}` : `/api/diary`;
        const method = editMode ? "PUT" : "POST";

        fetch(url, {
          method: method,
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ name }),
        })
          .then((res) => {
            if (!res.ok) throw new Error("ÏöîÏ≤≠ Ïã§Ìå®");
            return res.json();
          })
          .then((data) => {
            alert(editMode ? "ÏàòÏ†ï ÏôÑÎ£å" : "ÏÉùÏÑ± ÏôÑÎ£å");
            location.href = "/diary";
          })
          .catch((err) => alert(err.message));
      });
    </script>
  </body>
</html>
